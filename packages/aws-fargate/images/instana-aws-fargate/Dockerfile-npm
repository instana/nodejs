FROM node:12.22.7-buster AS instana-aws-fargate-build-nodejs

ARG package_version

WORKDIR /instana
COPY package.json.npm ./
RUN sed -e s/VERSION/$package_version/g package.json.npm > package.json
COPY .npmrc ./
COPY setup.sh ./

RUN npm install --only=production

RUN rm -f instana-*.tgz && \
 rm -f package.json && \
 rm -f package.json.npm && \
 rm -f .npmrc

FROM scratch

COPY --from=instana-aws-fargate-build-nodejs /instana /instana

